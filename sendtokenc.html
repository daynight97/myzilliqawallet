<!DOCTYPE html> 
<!--https://myzilliqawallet.com-->
<!--Clement T-->
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>My Zilliqa Wallet</title>
<link rel="icon" href="images/myzilliqawalletlogo.png">
  
<script src="js/jquery-3.3.1.min.js"></script>   
<script src="js/bootstrap.min.js"></script> 
<script src="js/zilliqa.min.js"></script>
<script src="js/all.min.js"></script>
<link href="css/bootstrap.min.css" rel="stylesheet" />

<style type="text/css">
.full-width {
    width: 100%;
    margin-left: 60px; 
}

 	
</style>
 
</head>
<body>
<div class="bs-1">
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a href="home.php" class="navbar-brand">
            <img src="images/myzilliqawalletsmall.png" height="28" alt="myZilliqaWallet">
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav">  				
				<a href="home.php" class="nav-item nav-link">Home</a>
				<a href="createwallet.php" class="nav-item nav-link">Create Wallet</a>
				<a href="sendtoken.html" class="nav-item nav-link   active">Send Tokens</a>
				<a href="zilstatistic.php" class="nav-item nav-link">Staking Statistic</a>	 				
            </div> 
        </div>
		<div class="navbar navbar-nav navbar-right">
					<a href="sendtokenc.html" class="nav-item nav-link  active">中文</a>
					<a href="sendtoken.html" class="nav-item nav-link  ">English</a>
		</div>			
		
		
    </nav>
	

	
	
	
</div>
 
 
	
	
 
 
 

 <div class="container-fluid full-width ">
 <br>
 <br>
 <h5> ZILLIQA (ZIL) 客户端钱包 v0.9.9.1b </h5>  
 这是真正100％的开放源代码客户端Zilliqa钱包。钱包仍在测试中，风险自负。 下载 <a href="https://github.com/daynight97/myzilliqawallet/releases/">源代码</a> 并从您的电脑上运行会更安全。<b>
<p id="instruction">请与互联网断接！然后使用方法1,2或3解锁您的钱包，然后按解锁钮。</p></b>
 <hr>
   
 <div class="row">
		  <div class="col-4">
		  <h5>您的钱包信息</h5>
		  <br>
		  <h5>
		  Bech32 地址
		  </h5>
		  <h6>
		  <p id="walletaddressbech32"> <p>
		  </h6>
		   
		  <h5>
		  ERC 地址
		  </h5>
		  <h6>		  
		  <p id="walletaddresserc20"> <p> 
		   	
		  <h5>		  		  
		  账户余额
		  </h5>
		  <h6>			  
		   <p id="walletzilbalance"> <p>  
		   	
		   <p id="walletgzilbalance"> <p>  
		  <br>			  
          </h6>
		  
		  <hr>
		   
		  <h5>节点</h5>
		  <h6>
		  <!-- For mainnet, the node is api.zilliqa.com, for testnet it is dev-api.zilliqa.com, and the chainid=1 for mainnet, 333 for testnet -->
           <!--	<input type="text"  class="form-control" id="walletnode" value="https://dev-api.zilliqa.com">  -->
		   <input type="text"  class="form-control" id="walletnode" value="https://api.zilliqa.com/"> 
				 
		  <br>
		  <h5>链ID</h5>  <small>主网=1, 测试网=333</small>
		  <h6>
          <!--		<input type="text"  class="form-control" id="walletchainid" value="333">			 -->
		  <input type="text"   class="form-control" id="walletchainid" value="1">		  
		  
		  
		  <hr>		  
		  
		  <h5>
		  <p id="txidlabel"></p>
		  </h5>
		  <h6 style="word-break: break-word;">
		  <p id="txid"></p>
	 
		  <p id="message" ><p>		   
		  </h6>
		  
		   <p id="message2"><p>
		  </div>
  
 
  
  
  
  
  
  
  
  
		  <div class="col-6"> 
		            <h4>解锁钱包</h4>
					<br>
					<h5>方法1：私钥</h5>
					<label >输入私钥</label>			 
					<input type="text"  class="form-control" id="privatekey" value="">
			        <br>

					<h5>方法2：助记符</h5>
					<label   >输入助记符</label>			 
					<input type="text"   class="form-control" id="mnemonic" value="">
			        <br>	
					
					<h5>方法3：密钥库</h5>
					 	 
					<input type="file" name="file" class="form-control" id="file-input" value="">
					<label   >输入密码</label>			 
					<input type="text"   class="form-control" id="passphrase" value="">			        
					
					
					
					<br>
					<button type="button" class="btn btn-primary btn-sm  btn-block" onclick="unlockwallet()">解锁</button> 
					<p id="msg4"></p>

					<hr>
					
					<br>						
					
					
					
					<button type="button" class="btn btn-primary btn-sm  btn-block" id="refreshbutton" onclick="refreshinternet()" disabled>刷新</button> 
					<hr>					
					
					
					<br> 					
					<h5>发送代币</h5>					

					
					<label   >发送地址</label>			 
					<input type="text"   class="form-control" id="destziladdress" value=""   disabled>	
					<br>
					
					<div class="row">
						<div  class="col-8">
									<label   >数量 (ZIL)</label>			 
									<input type="text"   class="form-control" id="amount" value=""   disabled>	
									<br>
 
						</div>
						<div  class="col-4">
									<label   >交易手续费(ZIL)</label>			 
									<input type="text"   class="form-control" id="gas" value="0.002"   disabled>	
									<br>
							  
						</div>						
					</div>
					 <button type="button" class="btn btn-primary btn-sm  btn-block" id="sendbutton" onclick="sendtxnow()"   disabled>发送</button> 
						
		  
		  </div>
 
  </div> 

	<p>
	
     
	<br> <hr>
				  

		 
  	  
	
	
	
	
	
	  
















 
 

 



 
 

<noscript>
  您需要启用JavaScript才能运行此应用。
</noscript>

  
</body>

 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

 
 
 
<script>
/*
https://myzilliqawallet.com  
A true 100% open-source client side Zilliqa wallet.
If you would like to reuse this code, please quote the source, thank you.

Programmed by : Clement T
Date: 4th Jan 2021
email: clement@myzilliqawallet.com

v0.9.9.0b
bug fixed:- No need to turn on internet when launch the sendtoken.html

Improvement:- Added gzil balance
*/

var zilliqa;
var VERSION;
var address;
var fileselected=0;     // for keystore
var keystore="EMPTY";   // for keystore
var address;
var balanceinzil=0;
var method=0;

function initvar()
{
 fileselected=0;     // for keystore
 keystore="EMPTY";   // for keystore	
 //balanceinzil=0;
	
}


async function initzilliqa()
{
	initvar();
	var node=document.getElementById("walletnode").value;
	
	
		try {
			zilliqa = new Zilliqa.Zilliqa(node);
		} catch(e) {
			errmsg="节点连接出错！ 请连接互联网，然后重新刷新！";
			alert(errmsg);	   
			return 0;			   
		}  
	
	


	var chainid=document.getElementById("walletchainid").value;  

	//const chainId = 333;  

	const msgVersion = 1;
	
	
	
	
		try {
			VERSION = Zilliqa.bytes.pack(chainid, msgVersion);	
		} catch(e) {
			errmsg="节点连接出错！ 请连接互联网，然后重新刷新！";
			alert(errmsg);	   
			return 0;			   
		}  	
	
	return 1;
	
}


function getValueByKey(object, row) {
  return object[row];
}





var gkeystore;
var gpassphrase;
var gprivatekey;
var gmnemonic;




async function unlockwallet()
{
	
	//await init();
	// here when we unlockwallet, it does not have internet, we can't use any zilliqa object yet
	// checking will be incomplete, wait until internet is resumed under refresh, then we check again.
   
	privateKey= document.getElementById('privatekey').value;
	mnemonic= document.getElementById('mnemonic').value;
  	document.getElementById("instruction").innerHTML="钱包已解锁！ 重新连接互联网，然后按刷新钮。";
   //document.getElementById("message2").innerHTML=keystore;
   
	   var passphrase=document.getElementById("passphrase").value;
	   if (fileselected==1 && keystore!="EMPTY" && passphrase.length>1) // seems like user selected keystore
	   {
	   
	   
	      		   method=3;
				   gkeystore=keystore;
				   gpassphrase=passphrase;	
		    
	   }
   
		/// first try private key
		if (privateKey.length>1)
		{
			if (!Zilliqa.validation.isPrivateKey(privateKey))
			{
				document.getElementById('privatekey').value="";
				alert("私钥无效!");	
				method=0;
				return;
			}
			else
			{
			
					try {
						////await zilliqa.wallet.addByPrivateKey(privateKey); 
						
						address = Zilliqa.getAddressFromPrivateKey(privateKey);
						document.getElementById("walletaddresserc20").innerHTML=address;  
						document.getElementById("walletaddressbech32").innerHTML=Zilliqa.toBech32Address(address);		
							
						gprivatekey=privateKey;
						method=1;						
				
					} catch(e) {
					    method=0;
						document.getElementById('privatekey').value="";
						//errmsg=destaddressbech32+" is an invalid ZIL address!!";
						alert("私钥无效!!");	   
						return;			   
					} 			
		
			}



			
		}
		
		if (mnemonic.length>10)
		{		
 
				method=2;
				gmnemonic=mnemonic;				
			    //document.getElementById("walletaddresserc20").innerHTML=address;  
			    //document.getElementById("walletaddressbech32").innerHTML=Zilliqa.toBech32Address(address);				
			
			  			
		}
		 
 
   
		var starstring="";
		if (method==1)
			document.getElementById('privatekey').value=starstring; // hide it after unlock
		else if (method==2)
			document.getElementById('mnemonic').value=starstring; // hide it after unlock
		else if (method==3)
			document.getElementById('passphrase').value=starstring; // hide it after unlock
		
		if (method!=0)
		{
			document.getElementById("refreshbutton").disabled = false;
		
		 
			document.getElementById("msg4").innerHTML="重新连接互联网，然后按刷新!";
		}

  
}




async function refreshinternet()
{
		 
		rtnval=	await initzilliqa();
		if (rtnval==0)
			return;
		 
		
		/// Now need to get connect wallet 
		if (method==0)
			return;
		
		if (method==1) // private key
		{
			try {
				await zilliqa.wallet.addByPrivateKey(privateKey); 
				 
				address = Zilliqa.getAddressFromPrivateKey(privateKey);
			    document.getElementById("walletaddresserc20").innerHTML=address;  
			    document.getElementById("walletaddressbech32").innerHTML=Zilliqa.toBech32Address(address);				
		
			} catch(e) {
			    method=0;
				document.getElementById('privatekey').value="";
				//errmsg=destaddressbech32+" is an invalid ZIL address!!";
				alert("私钥无效!");	   
				return;			   
			} 	
		
		
		}
		else if (method==2) 
		{
			try {
				address=await zilliqa.wallet.addByMnemonic(mnemonic);
				 
			    document.getElementById("walletaddresserc20").innerHTML=address;  
			    document.getElementById("walletaddressbech32").innerHTML=Zilliqa.toBech32Address(address);				
			
			} catch(e) {
			    method=0;
				//errmsg=destaddressbech32+" is an invalid ZIL address!!";
				document.getElementById('mnemonic').value="";
				alert("助记符无效!!");	   
				return;					   
			} 		
		
		
		
		}
		else if (method==3) 
		{
			try {
				 address=await zilliqa.wallet.addByKeystore(keystore , passphrase );   
			      
			     //console.log(address);
			     document.getElementById("walletaddresserc20").innerHTML=address;  
			     document.getElementById("walletaddressbech32").innerHTML=Zilliqa.toBech32Address(address);				 
			} catch(e) {
				//errmsg=destaddressbech32+" is an invalid ZIL address!!";
				 alert("密钥库/密码无效!");	   
				 method=0;
				 return;			   
			}		
		
		
		
		}
		
		
		
		
		
		
		
		
  
		var balance;
 		try {
		
			document.getElementById("walletzilbalance").innerHTML= '<i class="fas fa-spinner fa-spin fa-2x"></i>';
			document.getElementById("walletgzilbalance").innerHTML= '<i class="fas fa-spinner fa-spin fa-2x"></i>';		
		
		    balance = await zilliqa.blockchain.getBalance(address);	
			var qa=new Zilliqa.BN( balance.result.balance);
			balanceinzil=Zilliqa.units.fromQa(  qa, Zilliqa.units.Units.Zil );
			document.getElementById("walletzilbalance").innerHTML=balanceinzil+" ZIL";	
			document.getElementById("destziladdress").disabled = false;
			document.getElementById("amount").disabled = false; 
			document.getElementById("sendbutton").disabled = false; 
			document.getElementById("gas").disabled = false; 
			method=0;
			initvar();	
			document.getElementById("instruction").innerHTML="保持连接互联网，现在您可以开始发送ZIL";			
		} catch(e) {

			document.getElementById("walletzilbalance").innerHTML= '';
			document.getElementById("walletgzilbalance").innerHTML= '';		
		
		
			if (e=="TypeError: Network request failed")
			{
				alert ("重新连接互联网，然后按刷新!");
				return;	
			
			}
			else
			{
			//errmsg="This wallet has no balance!";
			//alert(errmsg);	
				alert("这个钱包没有余额！");
				return;	
			
			}
					   
		}   
		
		
		
		///// Now get the gzil balance
		
		var gzilsmartcontractaddress="zil14pzuzq6v6pmmmrfjhczywguu0e97djepxt8g3e";
		var gzildecimal=15;
		
		// need to convert bech32 address to erc20 address
		var erc20gziladdress=await Zilliqa.fromBech32Address(gzilsmartcontractaddress);
		
		var strlong="ERC20 Gzil contract address="+erc20gziladdress;
		//console.log(strlong);
		
		//smartcontractaddr="0x173Ca6770Aa56EB00511Dac8e6E13B3D7f16a5a5";
		const smartContractState = await zilliqa.blockchain.getSmartContractState(erc20gziladdress);
		//console.log(smartContractState.result); 
		
		
		//sampleaddr="0x0a836fbe1318f7b74b8462adcd5a89f587f7e447";
		// one of sample 0x0a836fbe1318f7b74b8462adcd5a89f587f7e447: "14798614386111"
        //gzilbalance=smartContractState.result.balances"]["0x0a836fbe1318f7b74b8462adcd5a89f587f7e447"];
		console.log("jsonrpc="+smartContractState.jsonrpc);
		if (address in smartContractState.result.balances) {
			//console.log ("Yes, found it in the list");
			
			gzilbalance=getValueByKey(smartContractState.result.balances, address);
			gzilbalance=gzilbalance/(10.0**gzildecimal);
			//gzilbalance=smartContractState.result.balances.[sampleaddr];
			outstr="Gzil balance="+gzilbalance;
			//console.log(outstr);
			document.getElementById("walletgzilbalance").innerHTML=gzilbalance+" gZIL";	
		}
		else
		{
			//console.log ("Not found!");
			document.getElementById("walletgzilbalance").innerHTML= "0 gZIL";	
		
		}
		//console.log("Test balance=");
		//console.log(gzilbalance);

		/*
		   "id": "1",
			"jsonrpc": "2.0",
			"result": {
				"_balance": "0",
				"admin": "0x2f604cbd408e2c8b7442b1b629a1288c44945130",
				"allowances": {},
				"balances": {
					"0x05d087623bc636108d450e0550ddbfc03da99fa9": "10000000",
					"0x0f8167a0cbffb8ab1d1919e31f83dc26c863d0f9": "24250000",
					"0x18c241a5f0d6cf380f721618880f2c2b7aa5ea97": "9975750000",
					"0x5abf71d798ca594b7317b04f52ad5a31fae62170": "10000000",
					"0x8c3de413a9d8d602a1757210ab539853103e08d8": "250000000000",
					"0x93eb1d0cb7ba3962fcc86cd28aa45b241c888277": "20000",
					"0xab61c57a9a4b2742a4a325ecd9e77b5da67f663a": "980000",
					"0xabe1e844c776e97beb619f3ca64faa2b3edc2840": "400000",
					"0xc48565c853fe4ffa5d7eac33e255141134640ceb": "600000",
					"0xf5f9e1ad8ea6439f625e12b8ef57e1e99ac2d383": "7000000"
				},
				"implementation": "0x3bd9ad6fee7bfdf5b5875828b555e4f702e427cd",
				"total_supply": "260029000000"



		*/
		
		// look for gzilbalance=result["balance"][address];		
 
}



 				
 
async function sendtx( destaddressbech32,   amountinzil ) {
   
	

  // Get Minimum Gas Price from blockchain
  const minGasPrice = await zilliqa.blockchain.getMinimumGasPrice();
 
  console.log(`Current Minimum Gas Price: ${minGasPrice.result}`);
 /////'2000' here is 0.002 ZIL as gas fee
  var gasinzil=document.getElementById("gas").value;
  if (gasinzil>10) // 10zil to be paid as zil? too highlight_file
  {
	  alert("交易手续费太高!");
	  return;	  
  }
  
  if (gasinzil<0.002) // 10zil to be paid as zil? too highlight_file
  {
	  alert("交易手续费太低!");
	  return;	  
  }  
  
  var gastobepaid=gasinzil*1000000;
  const myGasPrice = Zilliqa.units.toQa(gastobepaid, Zilliqa.units.Units.Li); // Gas Price that will be used by all transactions
  //console.log(`My Gas Price ${myGasPrice.toString()}`);
  const isGasSufficient = myGasPrice.gte(new Zilliqa.BN(minGasPrice.result)); // Checks if your gas price is less than the minimum gas price
  

  
  var destaddress=Zilliqa.fromBech32Address(destaddressbech32);
  var amounttosend= amountinzil ;
  // Send a transaction to the network
   
  
  document.getElementById("message").innerHTML= "Sending...."+'<i class="fas fa-spinner fa-spin  fa-2x"></i>';
  
  
  const tx = await zilliqa.blockchain.createTransactionWithoutConfirm(
    // Notice here we have a default function parameter named toDs which means the priority of the transaction.
    // If the value of toDs is false, then the transaction will be sent to a normal shard, otherwise, the transaction.
    // will be sent to ds shard. More info on design of sharding for smart contract can be found in.
    // https://blog.zilliqa.com/provisioning-sharding-for-smart-contracts-a-design-for-zilliqa-cd8d012ee735.
    // For payment transaction, it should always be false.
    zilliqa.transactions.new(
      {
        version: VERSION,
        toAddr: destaddress,
        amount: new Zilliqa.BN(
		
		
          Zilliqa.units.toQa(amounttosend, Zilliqa.units.Units.Zil),
        ), // Sending an amount in Zil (1) and converting the amount to Qa
        gasPrice: myGasPrice, // Minimum gasPrice veries. Check the `GetMinimumGasPrice` on the blockchain
        gasLimit: Zilliqa.Long.fromNumber(1),
      },
      false,
    ),
  );

  // process confirm
   

 
  document.getElementById("txidlabel").innerHTML="TXID";
  document.getElementById("txid").innerHTML= tx.id;
  
  
  document.getElementById("message").innerHTML= '<i class="fas fa-spinner fa-spin"></i>';
  
  
  const confirmedTxn = await tx.confirm(tx.id);  
  // Get Balance
  const newbalance = await zilliqa.blockchain.getBalance(address);	
  var qa=new Zilliqa.BN( newbalance.result.balance);
  balanceinzil=Zilliqa.units.fromQa(  qa, Zilliqa.units.Units.Zil );
  document.getElementById("walletzilbalance").innerHTML=balanceinzil+" ZIL";	  
  document.getElementById("message").innerHTML="Tx confirmed!";
 
}




async function sendtxnow()
{
		destaddressbech32= document.getElementById('destziladdress').value;	 
		amounttosendinzil= document.getElementById('amount').value;

		 

	   // check address
	   if (!Zilliqa.validation.isBech32(destaddressbech32))  // if this is not a valid bech32 address
	   {
			errmsg=destaddressbech32+" 是无效的ZIL地址！";
			alert(errmsg);	   
			return;
	   }
	   
		
		var erc20address="";
	 
	   
   
		try {
		    erc20address=await Zilliqa.fromBech32Address(destaddressbech32);
		} catch(e) {
			errmsg=destaddressbech32+" 是无效的ZIL地址！";
			alert(errmsg);	   
			return;	
		   
		}  
   
   
   
   
   
   
   
	   if (!Zilliqa.validation.isAddress(erc20address))
	   {
			errmsg=destaddressbech32+" 是无效的ZIL地址！";
			alert(errmsg);	   
			return;	   	   
	   }
	   
	   if (parseInt(amounttosendinzil, 10)>parseInt(balanceinzil, 10)) // insufficient balance to send
	   {
		   errmsg="您的帐户余额 ("+balanceinzil+" ZIL)"+" 少于 "+amounttosendinzil+ " ZIL";
			alert(errmsg);	   
		   return;	   
	   }

   
   
	  var gasinzil=document.getElementById("gas").value;
	  if (gasinzil>10) // 10zil to be paid as zil? too highlight_file
	  {
		  alert("交易手续费太高！");
		  return;	  
	  }
	  
	  if (gasinzil<0.002) // 10zil to be paid as zil? too highlight_file
	  {
		  alert("交易手续费太低！");
		  return;	  
	  }    
   
  
	  var txt;
	  confirmmsg="您确定要发送 "+amounttosendinzil+ " ZIL 至"+destaddressbech32+"?";
	  
	  
	  if (confirm(confirmmsg)) {
		sendtx( destaddressbech32,  amounttosendinzil );
	  } else {
		 
	  }
   
  
 
}

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
document.getElementById('file-input')
  .addEventListener('change', readSingleFile, false);	
 

// Added keystore support 
function readSingleFile(e) {
  fileselected=1; // user selected a file.
  var file = e.target.files[0];
  if (!file) {
    return;
  }
  var reader = new FileReader();
  reader.onload = function(e) {
    var contents = e.target.result;
	
    keystore=contents;
     
  };
  reader.readAsText(file);
}
 
 

window.addEventListener('load', initvar());

 
 

</script>
</html>